<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.5.0">
    <meta name="theme" content="spm 0.1">
    <title>关于Grunt，从一个简单的配置开始！ - spm document</title>
    <link rel="stylesheet" href="../static/one.css" />
    <link rel="stylesheet" href="../static/syntax.css" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38943643-2']);
      _gaq.push(['_trackPageview']);
      _gaq.push(['_trackPageLoadTime']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <div class="navigation" role="navigation">
        <h1 class="home"><a href="../">spmjs</a></h1>
        <div class="menu">
          <a style="color: #d00; font-weight: bold;" href="http://spmjs.io">[ 全新 spm3 现已发布 ]</a>
          <a href="../doc/">使用文档</a>
          <a href="../cli/config">命令集</a>
          <a href="../api/">开发者文档</a>
        </div>
    </div>
    <div id="color-bar"></div>

    <div class="row clearfix">
      <div class="column-left">
<div class="sidebar">
</div>
</div>
      <div class="column-right">
<div class="hentry typo">
  <h1 class="entry-title">关于Grunt，从一个简单的配置开始！</h1>
  <div class="entry-toc">
    <h3>Table of Contents</h3>
    <ul><li><a href="#简介">简介</a></li><li><a href="#安装">安装</a></li><li><a href="#传说中简单的配置t-t">传说中简单的配置T-T</a></li></ul>
  </div>

  <div class="entry-content"><p>玩儿转grunt，需要了解的知识稍微多一点，这里仅以一个简单的配置介绍grunt，希望能让你尽快的认识她。</p>
<p>进一步的了解，请移步官网：<a href="http://gruntjs.com/" title="Grunt">Grunt</a></p>
<h2 id="简介">简介</h2><p>Q：Grunt为何物？</p>
<p>A：一个专为JavaScript提供的构建工具。</p>
<p>Q：啥是构建工具？</p>
<p>A：在项目部署上线前，通常要将源文件压缩，合并，并拷贝到bch或trunk中。
在将js模块化后，又多了一个分析，提取业务代码中所依赖模块的工作。
解决这一系列繁重工作的自动化工具，称之为构建工具。</p>
<p>Q：grunt是如何工作的？</p>
<p>A：刚刚接触grunt，举个例子可能不太恰当，但应该可以让你先比较准确的认识她。
就好像一个万能工厂（grunt），只负责执行任务（Task），不关心每个任务到底都干了什么。
这些任务比如：</p>
<ul>
<li><p>clean:删除临时文件</p>
</li>
<li><p>uglify:压缩</p>
</li>
<li><p>qunit:测试</p>
</li>
<li><p>concat:合并</p>
</li>
</ul>
<p>任务流程可能是这样的：</p>
<ul>
<li><p>task:clean</p>
</li>
<li><p>task:uglify</p>
</li>
<li><p>task:qunit</p>
</li>
<li><p>task:concat</p>
</li>
</ul>
<h2 id="安装">安装</h2><p>前提是你已经安装了<code>nodejs</code>和<code>npm</code>。 你可以在 <a href="http://nodejs.org/">nodejs.org</a> 下载安装包安装，也可以通过包管理器（比如在 Mac 上用 homebrew，同时推荐在 Mac 上用 homebrew）。</p>
<p><strong>安装grunt CLI</strong></p>
<pre>npm install -g grunt-cli</pre><p>按照官方的说法，<code>grunt-cli</code>只是为了在同一台机器上安装不同的<code>grunt</code>版本，那么咱们先不去管他。</p>
<p><strong>在项目中使用grunt</strong></p>
<p>首先需要往项目里添加两个文件：<code>package.json</code>和<code>Gruntfile.js</code></p>
<ul>
<li>package.json:该文件用来为npm存放项目配置的元数据，与grunt关系最大的配置在devDependencies中。</li>
</ul>
<div class="highlight"><pre><code class="javascript"><span class="string">"devDependencies"</span>: {
    <span class="string">"grunt"</span>: <span class="string">"~0.4.1"</span>,
    <span class="string">"grunt-cmd-transport"</span>: <span class="string">"~0.2.0"</span>,
    <span class="string">"grunt-cmd-concat"</span>: <span class="string">"~0.2.0"</span>,
    <span class="string">"grunt-contrib-uglify"</span>: <span class="string">"~0.2.0"</span>,
    <span class="string">"grunt-contrib-clean"</span>: <span class="string">"~0.4.0"</span>
}</code></pre></div><ul>
<li>Gruntfile.js:注意G的大写，这个文件就是<code>grunt</code>的配置了，其中详细定义了每个任务的细节和执行任务的顺序等。</li>
</ul>
<p><strong>安装grunt</strong></p>
<p>在命令行进入项目所在目录，键入如下命令即可，<code>npm</code>会根据<code>devDependencies</code>中的配置，将需要的<code>grunt</code>及其插件下载到你的项目目录中。</p>
<pre>npm install grunt --save-dev</pre><h2 id="传说中简单的配置t-t">传说中简单的配置T-T</h2><p>终于到了简单配置环节，就从<code>Gruntfile.js</code>入手，一点点的认识<code>grunt</code>。</p>
<p>一个几乎是<code>Gruntfile.js</code>通用的写法：</p>
<div class="highlight"><pre><code class="javascript">module.exports = <span class="function"><span class="keyword">function</span><span class="params">(grunt)</span> {</span>
  grunt.initConfig({
    pkg: grunt.file.readJSON(<span class="string">'package.json'</span>);
  });
};</code></pre></div><p>由于篇幅关系，这里只简单说下。<code>grunt</code>配置的主体都在<code>grunt.initConfig</code>中</p>
<p><code>pkg: grunt.file.readJSON(&#39;package.json&#39;)</code>是为了以后在其它任务（task）中方便读取<code>package.json</code>已经定义好的值。</p>
<p>下面我们来了解下任务（task）：</p>
<div class="highlight"><pre><code class="javascript">transport: {
    dialog: {
        files : [
            {
                src : <span class="string">'*'</span>,
                dest : <span class="string">'.build/styles/component/dialog/src'</span>
            }
        ]
    }
}</code></pre></div><p><code>transport</code>就是一个任务（task），她是这次<code>spm2</code>所提供的一系列<code>grunt</code>构建插件的其中一个，该插件主要负责提取模块中的依赖，
并为每个模块设置<code>模块ID</code>。<code>dialog</code>是任务的其中一个目标（Target），<code>files</code>中定义了要对哪些文件执行该任务（src），
以及执行任务后，生成的文件放在什么地方(dest)。</p>
<p>下一个任务是合并(concat)：</p>
<div class="highlight"><pre><code class="javascript">concat: {
    dialog: {
        files: {
            <span class="string">"dist/styles/component/dialog/src/dialog.js"</span>: [<span class="string">".build/styles/component/dialog/src/dialog.js"</span>]
        }
    }
}</code></pre></div><p><code>concat</code>的内容是合并依赖的模块，有很多需要设置的地方，因为本文档目的只是介绍<code>grunt</code>，
所以这里简单说，该配置采用了另外一种<code>src</code>和<code>dest</code>的写法。相信大家只要理解了任务（task）和目标（target）后应该很好理解。</p>
<p>最后，加载<code>grunt</code>需要的插件：</p>
<div class="highlight"><pre><code class="javascript">grunt.loadNpmTasks(<span class="string">'grunt-cmd-transport'</span>);
grunt.loadNpmTasks(<span class="string">'grunt-cmd-concat'</span>);</code></pre></div><p>还要告诉grunt该怎么执行这些任务：</p>
<div class="highlight"><pre><code class="javascript">grunt.registerTask(<span class="string">'build'</span>, [<span class="string">'transport'</span>, <span class="string">'concat'</span>]);</code></pre></div><p>完整的<code>Gruntfile.js</code>：</p>
<div class="highlight"><pre><code class="javascript">module.exports = <span class="function"><span class="keyword">function</span><span class="params">(grunt)</span> {</span>
    grunt.initConfig({
        pkg: grunt.file.readJSON(<span class="string">'package.json'</span>),

        transport: {
            dialog: {
                files : [
                    {
                        src : <span class="string">'*'</span>,
                        dest : <span class="string">'.build/styles/component/dialog/src'</span>
                    }
                ]
            }
        },
        concat: {
            dialog: {
                files: {
                    <span class="string">"dist/styles/component/dialog/src/dialog.js"</span>: [<span class="string">".build/styles/component/dialog/src/dialog.js"</span>]
                }
            }
        }
    });

    grunt.loadNpmTasks(<span class="string">'grunt-cmd-transport'</span>);
    grunt.loadNpmTasks(<span class="string">'grunt-cmd-concat'</span>);

    grunt.registerTask(<span class="string">'build'</span>, [<span class="string">'transport'</span>, <span class="string">'concat'</span>]);
};</code></pre></div><p>最后的最后，进入项目所在目录，命令行输入：</p>
<pre>grunt build</pre><p>一切顺利的话，你就可以看到变化了！</p>
</div>
</div>
</div>
    </div>
    <div class="footer">
      <p class="copyright">powered by <a href="http://lab.lepture.com/nico/">nico</a> 0.5.0</p>
    </div>
    <script src="http://static.alipayobjects.com/seajs/1.2.1/sea.js" data-main="../static/one.js"></script>
    <div id="extra">
        <a href="https://github.com/spmjs/spm2" target="_blank">
            <img src="https://i.alipayobjects.com/e/201211/1dbSqT9ykm.png" width="149" height="149" alt="Fork me on GitHub"></a>
    </div>
    <!--<div class="github"><a class="github-link" href="https://github.com/spmjs/spm2">Fork me on GitHub</a></div>-->
  </body>
</html>